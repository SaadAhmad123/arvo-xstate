<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>arvo-xstate</title><meta name="description" content="Documentation for arvo-xstate"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><link rel="stylesheet" href="assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">arvo-xstate</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>arvo-xstate</h1></div><div class="tsd-panel tsd-typography"><p><a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/images/project_badges/sonarcloud-white.svg" alt="SonarCloud"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=alert_status" alt="Quality Gate Status"></a></p>
<a id="md:arvo" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Arvo<a href="#md:arvo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="md:what-is-arvo" class="tsd-anchor"></a><h2 class="tsd-anchor-link">What is Arvo<a href="#md:what-is-arvo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Arvo is an opinionated approach to building event-driven systems. It's designed as a pattern and methodology rather than a rigid framework.</p>
<a id="md:principal" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Principal<a href="#md:principal" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The core principle of Arvo is to provide a solid foundation with enough flexibility for customization, allowing you to impose your own technical posture, including security measures, event brokerage, and telemetry. While Arvo offers a structured approach, it encourages developers to implement their own solutions if they believe they can improve upon or diverge from Arvo's principles.</p>
<p>If you're looking to focus on results without getting bogged down in the nitty-gritty of event creation, handling, system state management, and telemetry, while also avoiding vendor lock-in, Arvo provides an excellent starting point. I believe, it strikes a balance between opinionated design and customization, making it an ideal choice for developers who want a head start in building event-driven systems without sacrificing flexibility.</p>
<p>Key features of Arvo include:</p>
<ul>
<li>Lightweight and unopinionated core</li>
<li>Extensible architecture</li>
<li>Cloud-agnostic design</li>
<li>Built-in primitives for event-driven patterns</li>
<li>Easy integration with existing systems and tools</li>
</ul>
<p>Whether you're building a small microservice or a large-scale distributed system, my hope with Arvo is to offers you some of the tools and patterns to help you succeed in the world of event-driven architecture.</p>
<a id="md:arvo-suite" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Arvo suite<a href="#md:arvo-suite" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Arvo is a collection of libraries which allows you to build the event driven system in the Arvo pattern. However, if you feel you don't have to use them or you can use them as you see fit.</p>
<table>
<thead>
<tr>
<th>Scope</th>
<th>NPM</th>
<th>Github</th>
<th>Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Orchestration</td>
<td><a href="https://www.npmjs.com/package/arvo-xstate?activeTab=readme" target="_blank" class="external">https://www.npmjs.com/package/arvo-xstate?activeTab=readme</a></td>
<td><a href="https://github.com/SaadAhmad123/arvo-xstate" target="_blank" class="external">https://github.com/SaadAhmad123/arvo-xstate</a></td>
<td><a href="https://saadahmad123.github.io/arvo-xstate/index.html" target="_blank" class="external">https://saadahmad123.github.io/arvo-xstate/index.html</a></td>
</tr>
<tr>
<td>Core</td>
<td><a href="https://www.npmjs.com/package/arvo-core?activeTab=readme" target="_blank" class="external">https://www.npmjs.com/package/arvo-core?activeTab=readme</a></td>
<td><a href="https://github.com/SaadAhmad123/arvo-core" target="_blank" class="external">https://github.com/SaadAhmad123/arvo-core</a></td>
<td><a href="https://saadahmad123.github.io/arvo-core/index.html" target="_blank" class="external">https://saadahmad123.github.io/arvo-core/index.html</a></td>
</tr>
<tr>
<td>Event Handling</td>
<td><a href="https://www.npmjs.com/package/arvo-event-handler?activeTab=readme" target="_blank" class="external">https://www.npmjs.com/package/arvo-event-handler?activeTab=readme</a></td>
<td><a href="https://github.com/SaadAhmad123/arvo-event-handler" target="_blank" class="external">https://github.com/SaadAhmad123/arvo-event-handler</a></td>
<td><a href="https://saadahmad123.github.io/arvo-event-handler/index.html" target="_blank" class="external">https://saadahmad123.github.io/arvo-event-handler/index.html</a></td>
</tr>
</tbody>
</table>
<a id="md:arvo---xstate" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Arvo - XState<a href="#md:arvo---xstate" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Arvo's event-driven system requires an orchestration mechanism capable of emitting events based on predefined rules. Arvo utilizes a state machine approach, where orchestration is defined in the form of a state chart. This state chart is then interpreted by a state machine engine to calculate the next events to emit and the resulting system state. It should be noted that this package does not impose a storage solution and it is upto the implementation to choose the best storage for events and state snapshots.</p>
<a id="md:documentation--resources" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Documentation &amp; Resources<a href="#md:documentation--resources" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Source</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Package</td>
<td><a href="https://www.npmjs.com/package/arvo-xstate?activeTab=readme" target="_blank" class="external">https://www.npmjs.com/package/arvo-xstate?activeTab=readme</a></td>
</tr>
<tr>
<td>Github</td>
<td><a href="https://github.com/SaadAhmad123/arvo-xstate" target="_blank" class="external">https://github.com/SaadAhmad123/arvo-xstate</a></td>
</tr>
<tr>
<td>Documenation</td>
<td><a href="https://saadahmad123.github.io/arvo-xstate/index.html" target="_blank" class="external">https://saadahmad123.github.io/arvo-xstate/index.html</a></td>
</tr>
</tbody>
</table>
<a id="md:core-concept" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Concept<a href="#md:core-concept" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The fundamental idea behind this orchestration is to enable the development of a simple functional model. For demonstration purposes, consider the following conceptual code:</p>
<pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">newSystemState</span><span class="hl-1">, </span><span class="hl-2">eventsToEmit</span><span class="hl-1"> } = </span><span class="hl-3">stateMachineEngine</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">stateChart</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">currentSystemState</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">event</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>To achieve this, the engine must execute events synchronously and provide the new system state along with events that need to be emitted.</p>
<a id="md:event-driven-patterns-and-arvo-xstate-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event-Driven Patterns and Arvo-XState Implementation<a href="#md:event-driven-patterns-and-arvo-xstate-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Arvo-XState's foundation is built on pure functional principles where state transitions are deterministic and side-effect free. This fundamental characteristic leads to natural, emergent support for sophisticated event-driven patterns without additional complexity. Just as pure functions naturally support composition, memoization, and parallelization, Arvo-XState's functional core naturally enables these enterprise patterns through its basic operation rather than through bolt-on features.</p>
<a id="md:event-sourcing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Sourcing<a href="#md:event-sourcing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Arvo-XState's foundation is built on the principle of deterministic state transitions, making it naturally suited for event sourcing. The state machine approach means every state change is triggered by an event, and these events form a complete history. When Arvo-XState processes an event, it maintains a clear sequence of what happened and why. Since the state machine is deterministic, replaying these events will always produce the same result, which is the cornerstone of event sourcing. The system's state at any point can be reconstructed by replaying events up to that moment, providing a reliable audit trail and debugging capabilities.</p>
<a id="md:cqrs-command-query-responsibility-segregation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">CQRS (Command Query Responsibility Segregation)<a href="#md:cqrs-command-query-responsibility-segregation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The architecture of Arvo-XState naturally separates commands and queries through its state machine design. Commands that modify state are handled through explicit state transitions, while the current state can be queried without affecting these transitions. This separation happens because Arvo-XState maintains a clear boundary between state changes (through events) and state reads. The orchestrator can emit different events for reads versus writes, allowing systems to handle them differently. This natural separation makes it straightforward to implement different storage and scaling strategies for reads and writes.</p>
<a id="md:saga-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Saga Pattern<a href="#md:saga-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Arvo-XState's state machine approach is well-suited for implementing sagas because it can model complex, long-running transactions as a series of state transitions. The state machine can track the progress of a distributed transaction and manage compensation actions if something fails. Since Arvo-XState maintains the current state and understands the sequence of events, it can coordinate the necessary steps to maintain consistency across different services. If a step fails, the state machine knows exactly where it was in the process and can trigger the appropriate compensation actions.</p>
<a id="md:event-choreography" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Choreography<a href="#md:event-choreography" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The event-driven nature of Arvo-XState makes it an excellent fit for event choreography. Services can interact through events without being tightly coupled with each other, and the state machine ensures proper coordination. For a reliable operation, the Arvo tries manage this coupliung between service via <code>ArvoContracts</code>. With this approach, the services are not tightly coupled rather they are bound by a domain wide contract. The state machine acts as a natural coordinator, ensuring events flow in the right sequence without requiring central orchestration.</p>
<a id="md:dead-letter-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dead Letter Pattern<a href="#md:dead-letter-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The deterministic nature of Arvo-XState's state machine makes it suitable for implementing dead letter queues. When events fail to process, the state machine can transition to error states and emit specific events for the dead letter queue. Since the state machine knows exactly what state it was in when the failure occurred, it can provide rich context about what went wrong. This makes it easier to implement retry mechanisms and handle failed events appropriately.</p>
<a id="md:materialized-views" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Materialized Views<a href="#md:materialized-views" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Arvo-XState's ability to emit events based on state transitions makes it effective for maintaining materialized views. As the state machine processes events and changes state, it can emit events specifically designed to update materialized views. The deterministic nature of the state machine ensures that views stay consistent with the underlying state, and the event-driven approach means views can be updated in real-time as changes occur.</p>
<a id="md:event-replay" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Replay<a href="#md:event-replay" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The deterministic nature of Arvo-XState makes it perfect for event replay scenarios. Since state transitions are purely functional (given the same input event and current state, they always produce the same output), replaying events will consistently reproduce the same system state. This makes it possible to debug issues, verify system behavior, or recover from failures by replaying the event stream.</p>
<a id="md:event-streaming" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event Streaming<a href="#md:event-streaming" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Arvo-XState's architecture makes it well-suited for event streaming scenarios. The state machine can process events as they arrive, maintaining state and emitting new events based on state transitions. The deterministic nature of the state machine means events are processed consistently, and the state machine can handle high volumes of events while maintaining system integrity. The ability to emit events based on state transitions means the system can participate in larger event streaming architectures while maintaining clear state management.</p>
<a id="md:xstate-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">XState Integration<a href="#md:xstate-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Arvo leverages XState as its state machine engine for several reasons:</p>
<ul>
<li><strong>Established Ecosystem</strong>: XState is a well-established state machine engine in the JavaScript/TypeScript ecosystem.</li>
<li><strong>SCXML Compatibility</strong>: It's compatible with the SCXML open standard, aligning with Arvo's commitment to leveraging open standards for widespread integration.</li>
<li><strong>Existing Technology</strong>: By using XState, Arvo doesn't need to recreate complex technology. Instead, it can fully utilize XState's engine, documentation, and ecosystem.</li>
<li><strong>Cross-domain Understanding</strong>: XState can be understood by both backend and frontend engineers, allowing for similar systems to be deployed across different environments.</li>
</ul>
<a id="md:core-components" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Components<a href="#md:core-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This package provides functions and classes to leverage xstate as state machine engine in the Arvo Event Driven system. The following are the main components:</p>
<ul>
<li><a href="documents/ArvoMachine__Core_Components_and_Event_Emission.html">ArvoMachine</a> is a restricted version of the XState machine. Its primary distinction lies in its prohibition of delayed transitions and invocations, as these tend to introduce asynchronous behavior. Arvo requires state machines to be fully synchronous.</li>
<li><a href="documents/ArvoOrchestrator.html">ArvoOrchestrator</a> is a class responsible for interpreting the machine configuration. It calculates the new system state and determines which events to emit based on a particular event execution.</li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can install the core package via <code>npm</code> or <code>yarn</code></p>
<pre><code class="bash"><span class="hl-3">npm</span><span class="hl-1"> </span><span class="hl-5">install</span><span class="hl-1"> </span><span class="hl-5">arvo-xstate</span><span class="hl-1"> </span><span class="hl-5">arvo-core</span><span class="hl-1"> </span><span class="hl-5">xstate@5.18.1</span>
</code><button type="button">Copy</button></pre>

<pre><code class="bash"><span class="hl-3">yarn</span><span class="hl-1"> </span><span class="hl-5">add</span><span class="hl-1"> </span><span class="hl-5">arvo-xstate</span><span class="hl-1"> </span><span class="hl-5">arvo-core</span><span class="hl-1"> </span><span class="hl-5">xstate@5.18.1</span>
</code><button type="button">Copy</button></pre>

<a id="md:arvo---detailed-usage-guide" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Arvo - Detailed Usage Guide<a href="#md:arvo---detailed-usage-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This guide provides a step-by-step explanation of how to set up and use an Arvo system, with commentary on each step.</p>
<a id="md:1-define-service-contracts" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. Define Service Contracts<a href="#md:1-define-service-contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">incrementServiceContract</span><span class="hl-1"> = </span><span class="hl-3">createArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">uri:</span><span class="hl-1"> </span><span class="hl-5">&#39;#/test/service/increment&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;com.number.increment&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">accepts:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">delta:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">number</span><span class="hl-1">(),</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">      </span><span class="hl-4">emits:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">&#39;evt.number.increment.success&#39;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">object</span><span class="hl-1">({</span><br/><span class="hl-1">          </span><span class="hl-4">newValue:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">number</span><span class="hl-1">(),</span><br/><span class="hl-1">        }),</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">decrementServiceContract</span><span class="hl-1"> = </span><span class="hl-3">createArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">uri:</span><span class="hl-1"> </span><span class="hl-5">&#39;#/test/service/decrement&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;com.number.decrement&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">accepts:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">delta:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">number</span><span class="hl-1">(),</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">      </span><span class="hl-4">emits:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">&#39;evt.number.decrement.success&#39;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">object</span><span class="hl-1">({</span><br/><span class="hl-1">          </span><span class="hl-4">newValue:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">number</span><span class="hl-1">(),</span><br/><span class="hl-1">        }),</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">numberUpdateNotificationContract</span><span class="hl-1"> = </span><span class="hl-3">createArvoContract</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">uri:</span><span class="hl-1"> </span><span class="hl-5">&#39;#/test/notification/decrement&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;notif.number.update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">accepts:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">delta:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">number</span><span class="hl-1">(),</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">enum</span><span class="hl-1">([</span><span class="hl-5">&#39;increment&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;decrement&#39;</span><span class="hl-1">]),</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">      </span><span class="hl-4">emits:</span><span class="hl-1"> {},</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Commentary:</strong>
Service contracts are fundamental in Arvo. They define the interface between your system and external services. Each contract specifies:</p>
<ul>
<li>A unique URI for the service</li>
<li>The type and schema of events the service accepts</li>
<li>The types and schemas of events the service emits</li>
</ul>
<p>This approach ensures type safety and clear communication boundaries. By defining these contracts upfront, you're creating a robust and self-documenting system architecture.</p>
<a id="md:2-create-machine-contract" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. Create Machine Contract<a href="#md:2-create-machine-contract" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">testMachineContract</span><span class="hl-1"> = </span><span class="hl-3">createArvoOrchestratorContract</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">uri:</span><span class="hl-1"> </span><span class="hl-5">&#39;#/test/machine&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">versions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">init:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">delta:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">number</span><span class="hl-1">(),</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">enum</span><span class="hl-1">([</span><span class="hl-5">&#39;increment&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;decrement&#39;</span><span class="hl-1">]),</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">      </span><span class="hl-4">complete:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">object</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">final:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-3">number</span><span class="hl-1">(),</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Commentary:</strong>
The machine contract defines the interface for your state machine orchestrator. It specifies:</p>
<ul>
<li>A unique URI and name for the machine</li>
<li>The schema for initialization events (what data is needed to start the machine)</li>
<li>The schema for completion events (what data is produced when the machine finishes)</li>
</ul>
<p>This contract acts as a blueprint for your machine, ensuring that it receives the correct input and produces the expected output. It's crucial for maintaining consistency across different parts of your system. This is especially useful in case of one orchestrator calling another orchestrator</p>
<a id="md:3-set-up-machine-environment" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Set Up Machine Environment<a href="#md:3-set-up-machine-environment" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">setup</span><span class="hl-1"> = </span><span class="hl-3">setupArvoMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">contracts:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">self:</span><span class="hl-1"> </span><span class="hl-4">testMachineContract</span><span class="hl-1">.</span><span class="hl-3">version</span><span class="hl-1">(</span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">services:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">increment:</span><span class="hl-1"> </span><span class="hl-4">incrementServiceContract</span><span class="hl-1">.</span><span class="hl-3">version</span><span class="hl-1">(</span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">decrement:</span><span class="hl-1"> </span><span class="hl-4">decrementServiceContract</span><span class="hl-1">.</span><span class="hl-3">version</span><span class="hl-1">(</span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">notification:</span><span class="hl-1"> </span><span class="hl-4">numberUpdateNotificationContract</span><span class="hl-1">.</span><span class="hl-3">version</span><span class="hl-1">(</span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">types:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">context:</span><span class="hl-1"> {} </span><span class="hl-6">as</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">delta</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-5">&#39;increment&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;decrement&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">errors</span><span class="hl-1">: </span><span class="hl-7">z</span><span class="hl-1">.</span><span class="hl-7">infer</span><span class="hl-1">&lt;</span><span class="hl-0">typeof</span><span class="hl-1"> </span><span class="hl-4">ArvoErrorSchema</span><span class="hl-1">&gt;[];</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">actions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">log</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">({ </span><span class="hl-4">context</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-4">assignEventError:</span><span class="hl-1"> </span><span class="hl-3">assign</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-3">errors</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> [</span><br/><span class="hl-1">        ...</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">errors</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1"> </span><span class="hl-6">as</span><span class="hl-1"> </span><span class="hl-7">z</span><span class="hl-1">.</span><span class="hl-7">infer</span><span class="hl-1">&lt;</span><span class="hl-0">typeof</span><span class="hl-1"> </span><span class="hl-4">ArvoErrorSchema</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">      ],</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">guards:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">isIncrement</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-5">&#39;increment&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">isDecrement</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-5">&#39;decrement&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Commentary:</strong>
This step creates the environment for your state machine. It's where you bring together all the pieces defined earlier:</p>
<ul>
<li>You specify the machine's own contract (<code>self</code>)</li>
<li>You list all the service contracts this machine will interact with</li>
<li>You define the shape of the machine's context (its internal state)</li>
<li>You can define reusable actions and guards</li>
</ul>
<p>This setup provides a strongly-typed foundation for your machine, enabling autocompletion and type checking in your IDE. It's a powerful way to catch potential issues early in the development process.</p>
<a id="md:4-define-machine-version" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Define Machine Version<a href="#md:4-define-machine-version" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">machineV100</span><span class="hl-1"> = </span><span class="hl-4">setup</span><span class="hl-1">.</span><span class="hl-3">createMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-5">&#39;counter&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">context</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">input</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    ...</span><span class="hl-4">input</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">errors:</span><span class="hl-1"> [] </span><span class="hl-6">as</span><span class="hl-1"> </span><span class="hl-7">z</span><span class="hl-1">.</span><span class="hl-7">infer</span><span class="hl-1">&lt;</span><span class="hl-0">typeof</span><span class="hl-1"> </span><span class="hl-4">ArvoErrorSchema</span><span class="hl-1">&gt;[],</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">  </span><span class="hl-4">initial:</span><span class="hl-1"> </span><span class="hl-5">&#39;route&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">route:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">always:</span><span class="hl-1"> [</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">guard:</span><span class="hl-1"> </span><span class="hl-5">&#39;isIncrement&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-5">&#39;increment&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">guard:</span><span class="hl-1"> </span><span class="hl-5">&#39;isDecrement&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-5">&#39;decrement&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-5">&#39;error&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">actions:</span><span class="hl-1"> </span><span class="hl-3">assign</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-3">errors</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> [</span><br/><span class="hl-1">              ...</span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">errors</span><span class="hl-1">,</span><br/><span class="hl-1">              {</span><br/><span class="hl-1">                </span><span class="hl-4">errorName:</span><span class="hl-1"> </span><span class="hl-5">&#39;Invalid type&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-4">errorMessage:</span><span class="hl-1"> </span><span class="hl-5">`Invalid operation type =&gt; </span><span class="hl-0">${</span><span class="hl-4">context</span><span class="hl-8">.</span><span class="hl-4">type</span><span class="hl-0">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-4">errorStack:</span><span class="hl-1"> </span><span class="hl-0">null</span><span class="hl-1">,</span><br/><span class="hl-1">              },</span><br/><span class="hl-1">            ],</span><br/><span class="hl-1">          }),</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      ],</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">increment:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">entry:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-3">emit</span><span class="hl-1">(({ </span><span class="hl-4">context</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;com.number.increment&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">delta:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">delta</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        })),</span><br/><span class="hl-1">      ],</span><br/><span class="hl-1">      </span><span class="hl-4">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">&#39;evt.number.increment.success&#39;</span><span class="hl-4">:</span><span class="hl-1"> { </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-5">&#39;notification&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-5">&#39;sys.com.number.increment.error&#39;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-5">&#39;error&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">actions:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;assignEventError&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">decrement:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">entry:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-3">emit</span><span class="hl-1">(({ </span><span class="hl-4">context</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;com.number.decrement&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">delta:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">delta</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        })),</span><br/><span class="hl-1">      ],</span><br/><span class="hl-1">      </span><span class="hl-4">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">&#39;evt.number.decrement.success&#39;</span><span class="hl-4">:</span><span class="hl-1"> { </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-5">&#39;notification&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-5">&#39;sys.com.number.increment.error&#39;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-5">&#39;error&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">actions:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;assignEventError&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">notification:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">entry:</span><span class="hl-1"> [</span><br/><span class="hl-1">        { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;log&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;enqueueArvoEvent&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-3">params</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;notif.number.update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-4">delta:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">delta</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1">,</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">          }),</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      ],</span><br/><span class="hl-1">      </span><span class="hl-4">always:</span><span class="hl-1"> { </span><span class="hl-4">target:</span><span class="hl-1"> </span><span class="hl-5">&#39;done&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">done:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;final&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-4">error:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;final&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">output</span><span class="hl-4">:</span><span class="hl-1"> ({ </span><span class="hl-4">context</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-4">final:</span><span class="hl-1"> </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">delta</span><span class="hl-1">,</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Commentary:</strong>
Here, you're defining the actual behavior of your state machine. This includes:</p>
<ul>
<li>Version information (useful for managing multiple versions of a machine)</li>
<li>An ID for the machine</li>
<li>How the initial context is created from the input</li>
<li>The states of the machine and transitions between them</li>
<li>How the final output is produced from the context</li>
</ul>
<p>This is where the logic of your system lives. The structure provided by Arvo helps keep this logic organized and manageable, even as it grows in complexity.</p>
<a id="md:5-create-orchestrator" class="tsd-anchor"></a><h3 class="tsd-anchor-link">5. Create Orchestrator<a href="#md:5-create-orchestrator" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">orchestrator</span><span class="hl-1"> = </span><span class="hl-3">createArvoOrchestrator</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">contract:</span><span class="hl-1"> </span><span class="hl-4">testMachineContract</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">executionunits:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">machines:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-4">machineV100</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">opentelemetry:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">inheritFrom:</span><span class="hl-1"> </span><span class="hl-5">&#39;event&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Commentary:</strong>
The orchestrator is the runtime that executes your state machines. By creating it, you're setting up:</p>
<ul>
<li>How many execution units to use (for concurrency)</li>
<li>Which machine versions to include</li>
<li>How to handle OpenTelemetry for tracing and monitoring</li>
</ul>
<p>This step bridges the gap between your machine definitions and their actual execution. It's where your static definitions become a running system.</p>
<a id="md:6-execute-orchestration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">6. Execute Orchestration<a href="#md:6-execute-orchestration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">eventSubject</span><span class="hl-1"> = </span><span class="hl-4">ArvoOrchestrationSubject</span><span class="hl-1">.</span><span class="hl-3">new</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">orchestator:</span><span class="hl-1"> </span><span class="hl-5">&#39;arvo.orc.test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">initiator:</span><span class="hl-1"> </span><span class="hl-5">&#39;com.test.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">event</span><span class="hl-1"> = </span><span class="hl-3">createArvoEventFactory</span><span class="hl-1">(</span><span class="hl-4">testMachineContract</span><span class="hl-1">.</span><span class="hl-3">version</span><span class="hl-1">(</span><span class="hl-5">&#39;0.0.1)).accepts(</span><span class="hl-10">{</span><br/><span class="hl-1">  </span><span class="hl-4">source</span><span class="hl-1">: </span><span class="hl-5">&#39;com.test.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">subject</span><span class="hl-1">: </span><span class="hl-4">eventSubject</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">data</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;increment&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">delta:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">let</span><span class="hl-1"> { </span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">events</span><span class="hl-1">, </span><span class="hl-4">executionStatus</span><span class="hl-1">, </span><span class="hl-4">snapshot</span><span class="hl-1"> } = </span><span class="hl-4">orchestrator</span><span class="hl-1">.</span><span class="hl-3">execute</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">state:</span><span class="hl-1"> </span><span class="hl-0">null</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Commentary:</strong>
This is where your system comes to life. You're:</p>
<ol>
<li>Creating a subject for the orchestration (think of it as a unique identifier for this execution)</li>
<li>Creating an initial event to kick off the orchestration</li>
<li>Executing the orchestrator with this event</li>
</ol>
<p>The orchestrator returns:</p>
<ul>
<li>The new state of the system</li>
<li>Any events that need to be emitted</li>
<li>The execution status</li>
<li>A snapshot of the current state</li>
</ul>
<p>This step is crucial because it's where your system actually starts doing work in response to events.</p>
<a id="md:7-handle-subsequent-events" class="tsd-anchor"></a><h3 class="tsd-anchor-link">7. Handle Subsequent Events<a href="#md:7-handle-subsequent-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">nextEvent</span><span class="hl-1"> = </span><span class="hl-3">createArvoEventFactory</span><span class="hl-1">(</span><span class="hl-4">incrementServiceContract</span><span class="hl-1">.</span><span class="hl-3">version</span><span class="hl-1">(</span><span class="hl-5">&#39;0.0.1&#39;</span><span class="hl-1">)).</span><span class="hl-3">emits</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;evt.number.increment.success&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-5">&#39;com.test.service&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">subject:</span><span class="hl-1"> </span><span class="hl-4">eventSubject</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">newValue:</span><span class="hl-1"> </span><span class="hl-9">10</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">to:</span><span class="hl-1"> </span><span class="hl-4">events</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-4">source</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">traceparent:</span><span class="hl-1"> </span><span class="hl-4">events</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-4">traceparent</span><span class="hl-1"> ?? </span><span class="hl-0">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">tracestate:</span><span class="hl-1"> </span><span class="hl-4">events</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-4">tracestate</span><span class="hl-1"> ?? </span><span class="hl-0">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-1">{ </span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">events</span><span class="hl-1">, </span><span class="hl-4">executionStatus</span><span class="hl-1">, </span><span class="hl-4">snapshot</span><span class="hl-1"> } = </span><span class="hl-4">orchestrator</span><span class="hl-1">.</span><span class="hl-3">execute</span><span class="hl-1">({ </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">nextEvent</span><span class="hl-1">, </span><span class="hl-4">state:</span><span class="hl-1"> </span><span class="hl-4">state</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p><strong>Commentary:</strong>
This final step shows how to continue the orchestration with subsequent events. You're:</p>
<ol>
<li>Creating a new event (in this case, a response from a service)</li>
<li>Executing the orchestrator again with this new event and the previous state</li>
</ol>
<p>This process continues until the machine reaches a final state. It's how your system responds to and processes a series of events over time.</p>
<p>By following these steps, you create a robust, type-safe, event-driven system using Arvo. Each step builds on the previous ones, creating a coherent and powerful application architecture.</p>
<a id="md:license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#md:license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This package is available under the MIT License. For more details, refer to the <a href="documents/LICENSE.html">LICENSE.md</a> file in the project repository.</p>
<a id="md:change-logs" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Change Logs<a href="#md:change-logs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>For a detailed list of changes and updates, please refer to the <a href="documents/CHANGELOG.html">document</a> file.</p>
<a id="md:sonarcloud-metrics" class="tsd-anchor"></a><h3 class="tsd-anchor-link">SonarCloud Metrics<a href="#md:sonarcloud-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=alert_status" alt="Quality Gate Status"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=bugs" alt="Bugs"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=code_smells" alt="Code Smells"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=coverage" alt="Coverage"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=duplicated_lines_density" alt="Duplicated Lines (%)"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=ncloc" alt="Lines of Code"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=reliability_rating" alt="Reliability Rating"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=security_rating" alt="Security Rating"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=sqale_index" alt="Technical Debt"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=sqale_rating" alt="Maintainability Rating"></a>
<a href="https://sonarcloud.io/summary/new_code?id=SaadAhmad123_arvo-xstate" target="_blank" class="external"><img src="https://sonarcloud.io/api/project_badges/measure?project=SaadAhmad123_arvo-xstate&amp;metric=vulnerabilities" alt="Vulnerabilities"></a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:arvo"><span>Arvo</span></a><ul><li><a href="#md:what-is-arvo"><span>What is <wbr/>Arvo</span></a></li><li><a href="#md:principal"><span>Principal</span></a></li><li><a href="#md:arvo-suite"><span>Arvo suite</span></a></li></ul><a href="#md:arvo---xstate"><span>Arvo -<wbr/> XState</span></a><ul><li><a href="#md:documentation--resources"><span>Documentation &amp; <wbr/>Resources</span></a></li><li><a href="#md:core-concept"><span>Core <wbr/>Concept</span></a></li><li><a href="#md:event-driven-patterns-and-arvo-xstate-implementation"><span>Event-<wbr/>Driven <wbr/>Patterns and <wbr/>Arvo-<wbr/>XState <wbr/>Implementation</span></a></li><li><ul><li><a href="#md:event-sourcing"><span>Event <wbr/>Sourcing</span></a></li><li><a href="#md:cqrs-command-query-responsibility-segregation"><span>CQRS (<wbr/>Command <wbr/>Query <wbr/>Responsibility <wbr/>Segregation)</span></a></li><li><a href="#md:saga-pattern"><span>Saga <wbr/>Pattern</span></a></li><li><a href="#md:event-choreography"><span>Event <wbr/>Choreography</span></a></li><li><a href="#md:dead-letter-pattern"><span>Dead <wbr/>Letter <wbr/>Pattern</span></a></li><li><a href="#md:materialized-views"><span>Materialized <wbr/>Views</span></a></li><li><a href="#md:event-replay"><span>Event <wbr/>Replay</span></a></li><li><a href="#md:event-streaming"><span>Event <wbr/>Streaming</span></a></li></ul></li><li><a href="#md:xstate-integration"><span>XState <wbr/>Integration</span></a></li><li><a href="#md:core-components"><span>Core <wbr/>Components</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:arvo---detailed-usage-guide"><span>Arvo -<wbr/> <wbr/>Detailed <wbr/>Usage <wbr/>Guide</span></a></li><li><ul><li><a href="#md:1-define-service-contracts"><span>1. <wbr/>Define <wbr/>Service <wbr/>Contracts</span></a></li><li><a href="#md:2-create-machine-contract"><span>2. <wbr/>Create <wbr/>Machine <wbr/>Contract</span></a></li><li><a href="#md:3-set-up-machine-environment"><span>3. <wbr/>Set <wbr/>Up <wbr/>Machine <wbr/>Environment</span></a></li><li><a href="#md:4-define-machine-version"><span>4. <wbr/>Define <wbr/>Machine <wbr/>Version</span></a></li><li><a href="#md:5-create-orchestrator"><span>5. <wbr/>Create <wbr/>Orchestrator</span></a></li><li><a href="#md:6-execute-orchestration"><span>6. <wbr/>Execute <wbr/>Orchestration</span></a></li><li><a href="#md:7-handle-subsequent-events"><span>7. <wbr/>Handle <wbr/>Subsequent <wbr/>Events</span></a></li></ul></li><li><a href="#md:license"><span>License</span></a></li><li><a href="#md:change-logs"><span>Change <wbr/>Logs</span></a></li><li><ul><li><a href="#md:sonarcloud-metrics"><span>Sonar<wbr/>Cloud <wbr/>Metrics</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>arvo-xstate</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/KillerJulian/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
