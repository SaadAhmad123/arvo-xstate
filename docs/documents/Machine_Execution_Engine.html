<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Machine Execution Engine | arvo-xstate</title><meta name="description" content="Documentation for arvo-xstate"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">arvo-xstate</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">arvo-xstate</a></li><li><a href="Machine_Execution_Engine.html">Machine Execution Engine</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="md:machine-execution-engine" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Machine Execution Engine<a href="#md:machine-execution-engine" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="md:overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#md:overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Machine Execution Engine stands as a foundational component within the Arvo orchestration system, serving as the powerhouse behind state machine execution and lifecycle management. Working in seamless coordination with the <code>ArvoOrchestrator</code>, it brings machine definitions to life through the <code>MachineRegistry</code> while maintaining state persistence via <code>MachineMemory</code>.</p>
<a id="md:architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Architecture<a href="#md:architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>At its core, the execution engine operates as an integral part of the Arvo orchestration system's architecture. The system follows a clean, hierarchical structure where the ArvoOrchestrator coordinates between three main components: the <code>MachineRegistry</code> for resolving machine definitions, <code>MachineMemory</code> for state management, and the <code>MachineExecutionEngine</code> for handling execution logic.</p>
<pre><code class="typescript"><span class="hl-4">ArvoOrchestrator</span><br/><span class="hl-1">  ├── </span><span class="hl-4">MachineRegistry</span><span class="hl-1">  </span><span class="hl-11">// Resolves machine definitions</span><br/><span class="hl-1">  ├── </span><span class="hl-4">MachineMemory</span><span class="hl-1">    </span><span class="hl-11">// Manages persistent state</span><br/><span class="hl-1">  └── </span><span class="hl-4">MachineExecutionEngine</span><span class="hl-1">  </span><span class="hl-11">// Handles execution logic</span>
</code><button type="button">Copy</button></pre>

<p>The orchestrator follows a carefully designed event processing flow. When an event arrives, the system first resolves the appropriate machine through the registry. It then retrieves any existing state from memory, processes the event through the execution engine, and finally persists the updated state back to memory. This orchestrated flow ensures consistent and reliable state machine execution across the entire system.</p>
<a id="md:core-interface" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Interface<a href="#md:core-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The engine exposes a clean, deterministic interface for machine execution that prioritizes simplicity and predictability:</p>
<pre><code class="typescript"><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-7">IMachineExecutionEngine</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">execute</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">machine</span><span class="hl-1">,  </span><span class="hl-11">// Resolved machine definition</span><br/><span class="hl-1">    </span><span class="hl-4">state</span><span class="hl-1">,    </span><span class="hl-11">// Current state (null for new executions)</span><br/><span class="hl-1">    </span><span class="hl-4">event</span><span class="hl-1">     </span><span class="hl-11">// Triggering event</span><br/><span class="hl-1">  }: </span><span class="hl-7">ExecuteMachineInput</span><span class="hl-1">): </span><span class="hl-7">ExecuteMachineOutput</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:default-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Default Implementation<a href="#md:default-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The default implementation, <code>MachineExecutionEngine</code>, leverages the power of <a href="https://stately.ai/docs" target="_blank" class="external">XState</a> to provide robust state machine execution. This implementation handles two distinct execution scenarios that form the backbone of state machine orchestration.</p>
<p>For new workflow executions, the engine creates a fresh start by instantiating a new <a href="https://stately.ai/docs/actors" target="_blank" class="external">XState actor</a> with the machine's logic. It carefully validates that the triggering event matches the machine's expected source type, sets up the initial machine context using the event data, and begins execution from the machine's defined initial state.</p>
<p>When dealing with existing workflows, the engine takes a different approach. It reconstructs the XState actor using the stored snapshot, restores the machine's previous context and state, and processes the new event within the existing workflow context. This allows for seamless continuation of execution from the last known state point.</p>
<p>This dual-mode architecture ensures that the engine can handle both new workflow initiations and continued processing of existing workflows while maintaining execution continuity and state persistence between events.</p>
<a id="md:custom-engine-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Custom Engine Implementation<a href="#md:custom-engine-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The system's flexible architecture allows for custom execution engine implementations to support different state machine libraries or patterns. Here's an example of how a custom engine might be implemented:</p>
<pre><code class="typescript"><span class="hl-0">class</span><span class="hl-1"> </span><span class="hl-7">CustomExecutionEngine</span><span class="hl-1"> </span><span class="hl-0">implements</span><span class="hl-1"> </span><span class="hl-7">IMachineExecutionEngine</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">execute</span><span class="hl-1">({ </span><span class="hl-4">machine</span><span class="hl-1">, </span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> }: </span><span class="hl-7">ExecuteMachineInput</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-11">// Initialize or resume execution based on state presence</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">executor</span><span class="hl-1"> = </span><span class="hl-4">state</span><span class="hl-1"> </span><br/><span class="hl-1">      ? </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">resumeExecution</span><span class="hl-1">(</span><span class="hl-4">state</span><span class="hl-1">)</span><br/><span class="hl-1">      : </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">startExecution</span><span class="hl-1">(</span><span class="hl-4">machine</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><br/><span class="hl-1">    </span><span class="hl-11">// Process the incoming event</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-4">executor</span><span class="hl-1">.</span><span class="hl-3">process</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-11">// Return execution output with updated state and events</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">state:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">snapshot</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">events:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">emittedEvents</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">finalOutput:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">output</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>When implementing a custom engine, several key requirements must be met. The engine should support both new and resumed executions, implement robust event processing capabilities, and generate appropriate event outputs. It must handle the complete execution lifecycle while integrating with system telemetry and implementing comprehensive error handling strategies.</p>
<a id="md:system-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">System Integration<a href="#md:system-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The execution engine integrates seamlessly with other system components through well-defined interfaces:</p>
<pre><code class="typescript"><span class="hl-0">class</span><span class="hl-1"> </span><span class="hl-7">ArvoOrchestrator</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">constructor</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">executionEngine</span><span class="hl-1">,  </span><span class="hl-11">// IMachineExecutionEngine</span><br/><span class="hl-1">    </span><span class="hl-4">memory</span><span class="hl-1">,          </span><span class="hl-11">// IMachineMemory</span><br/><span class="hl-1">    </span><span class="hl-4">registry</span><span class="hl-1">         </span><span class="hl-11">// IMachineRegistry</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>The system's data flow follows a structured pattern where events flow through the orchestrator to the registry for machine resolution, then to memory for state retrieval, through the execution engine for processing, back to memory for state persistence, and finally return to the orchestrator for event emission.</p>
<a id="md:best-practices" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Best Practices<a href="#md:best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>State management in the execution engine requires careful attention to detail. Transitions between states must be handled atomically to ensure consistency, while proper resource cleanup prevents memory leaks and other performance issues. State integrity should be validated at system boundaries to catch potential issues early in the execution cycle.</p>
<p>Event processing demands equal attention to detail. The system must preserve strict event ordering to maintain execution consistency, while implementing graceful error recovery ensures system reliability. Support for event replay capabilities helps with debugging and system recovery scenarios, and maintaining event idempotency prevents duplicate processing issues.</p>
<p>Integration with the broader system requires adherence to interface contracts and implementation of comprehensive telemetry. Custom implementations should handle all possible execution scenarios while maintaining backward compatibility with existing systems. Clear documentation of integration requirements helps prevent implementation issues and reduces system integration time.</p>
<a id="md:additional-resources" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Additional Resources<a href="#md:additional-resources" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>For more detailed information about the Machine Execution Engine, you can refer to our <a href="https://github.com/SaadAhmad123/arvo-xstate/blob/main/src/MachineExecutionEngine/ExecutionDiagrams.md" target="_blank" class="external">detailed execution flow diagrams</a>. The <a href="https://stately.ai/docs/quick-start" target="_blank" class="external">XState documentation</a> provides additional context for the default implementation.</p>
<a id="md:contributing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contributing<a href="#md:contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We welcome contributions to the Machine Execution Engine. Please review our contribution guidelines in the <a href="http://CONTRIBUTING.md" target="_blank" class="external">CONTRIBUTING.md</a> file for detailed information about our development process, coding standards, and pull request procedures.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:machine-execution-engine"><span>Machine <wbr/>Execution <wbr/>Engine</span></a><ul><li><a href="#md:overview"><span>Overview</span></a></li><li><a href="#md:architecture"><span>Architecture</span></a></li><li><a href="#md:core-interface"><span>Core <wbr/>Interface</span></a></li><li><a href="#md:default-implementation"><span>Default <wbr/>Implementation</span></a></li><li><a href="#md:custom-engine-implementation"><span>Custom <wbr/>Engine <wbr/>Implementation</span></a></li><li><a href="#md:system-integration"><span>System <wbr/>Integration</span></a></li><li><a href="#md:best-practices"><span>Best <wbr/>Practices</span></a></li><li><a href="#md:additional-resources"><span>Additional <wbr/>Resources</span></a></li><li><a href="#md:contributing"><span>Contributing</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>arvo-xstate</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/KillerJulian/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
